#!/usr/bin/env bash
# GitFlow pre-push hook â€” prevents pushing directly to main or develop.
# Feature branches must be pushed to origin and PRs must target develop.
#
# Install (one-time):
#   git config core.hooksPath .githooks
#
# Or symlink into .git/hooks/:
#   ln -sf ../../.githooks/pre-push .git/hooks/pre-push

set -euo pipefail

PROTECTED_BRANCHES="^(main|develop)$"

while read -r local_ref local_sha remote_ref remote_sha; do
    # Extract branch name from refs/heads/<branch>
    remote_branch="${remote_ref#refs/heads/}"

    if [[ "$remote_branch" =~ $PROTECTED_BRANCHES ]]; then
        echo "ERROR: Direct push to '$remote_branch' is not allowed."
        echo ""
        echo "  GitFlow requires all changes to go through Pull Requests."
        echo "  Push to a feature branch and open a PR targeting 'develop':"
        echo ""
        echo "    git push origin feature/<name>"
        echo "    gh pr create --base develop"
        echo ""
        exit 1
    fi
done

exit 0
